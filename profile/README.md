# Ticket Booking System

## Описание проекта

**Ticket Booking System** — распределённая микросервисная система для покупки и бронирования билетов на мероприятия.  
Система моделирует реальные бизнес-процессы билетных платформ и реализует полный цикл работы с мероприятиями, пользователями, бронированием, оплатой, лояльностью и аналитикой.

Проект разработан в рамках командной работы (2–4 человека) и соответствует требованиям к микросервисным системам с явным и реактивным взаимодействием сервисов.

---

## Применённые технологии

- **Язык программирования:** C#
- **Платформа:** .NET 9
- **Backend:** ASP.NET Core
- **API Gateway:** REST (HTTP Gateway)
- **Межсервисное взаимодействие:** gRPC (Protocol Buffers)
- **Асинхронное взаимодействие:** Apache Kafka
- **Архитектура:** Microservices, Hexagonal Architecture (Ports & Adapters), Event-Driven Architecture
- **Контейнеризация:** Docker
- **Инструменты:** Git, Swagger / OpenAPI, Postman

---

## Архитектура системы

Система построена на основе **микросервисной архитектуры** с разделением ответственности между сервисами и использованием двух типов взаимодействия:

- **Явное взаимодействие** — gRPC
- **Реактивное взаимодействие** — Apache Kafka

Каждый сервис реализован с использованием **гексагональной архитектуры (Ports & Adapters)** и может разворачиваться независимо.

---

## Состав системы

### HTTP Gateway
- Единая точка входа в систему
- RESTful API
- Аутентификация и авторизация пользователей
- Проксирование запросов к внутренним gRPC-сервисам

---

### User Service
**Мастер-система для сущности пользователя**

Функции:
- Регистрация пользователей по никнейму, почте и паролю
- Авторизация пользователей
- Хранение ролей (Пользователь, Организатор, Администратор)
- Блокировка и разблокировка пользователей

Kafka-события:
- создание пользователя (для инициализации кошелька и аккаунта лояльности)
- блокировка / разблокировка пользователя

---

### Event Service
**Мастер-система для сущностей мероприятий и площадок**

Функции:
- Создание и редактирование мероприятий
- Управление площадками проведения
- Управление схемами залов и мест
- Валидация доступности мест при бронировании
- Отметка проданных мест

Event Service является источником истины для:
- мероприятий
- площадок
- схем залов
- состояния мест

Kafka-события:
- создание мероприятия
- изменение заполненности зала

---

### Ticket Service
Функции:
- Реализация полного цикла бронирования билетов:
  - создание брони
  - проверка доступности мест
  - ожидание оплаты
  - подтверждение брони
  - выдача билета
- Отмена бронирования:
  - по таймауту
  - вручную пользователем
  - при неуспешной оплате
- Возврат билетов после покупки
- Освобождение мест при отмене бронирования

Kafka-события:
- бронирование билетов
- возврат билетов

---

### Payment Service
Функции:
- Управление кошельками пользователей
- Пополнение баланса
- Списание средств при покупке билетов
- Возврат средств при отмене бронирования или возврате билетов
- Корректная обработка запросов на оплату

Kafka-события:
- статус оплаты (успех / ошибка)

---

### Loyalty Service
Функции:
- Создание аккаунта лояльности пользователя
- Хранение баллов и истории операций
- Управление уровнем лояльности пользователя
- Валидация и применение промокодов
- Расчёт скидок с учётом правил промокодов
- Корректная обработка баллов и скидок при возврате билетов и денежных средств
- Блокировка аккаунта лояльности при блокировке пользователя

Kafka-события:
- изменение уровня лояльности
- начисление и списание баллов

---

### Analytic Service
**Сервис, интегрирующийся только через Kafka**

Функции:
- Сбор статистики по продажам билетов
- Подсчёт количества проданных и возвращённых билетов
- Формирование статистики по мероприятиям:
  - заполняемость зала
  - общее количество билетов
- Формирование статистики по артистам:
  - количество мероприятий за период
  - количество посетителей

Analytic Service не использует gRPC и получает данные исключительно из Kafka-топиков.

---

## Бизнес-процессы системы

Система реализует несколько независимых бизнес-процессов:

1. **Создание и управление мероприятиями**
   - Event Service является мастер-системой
   - Используется другими сервисами для валидации

2. **Бронирование и покупка билетов**
   - Ticket Service
   - Зависит от данных Event Service (валидация мест через gRPC)

3. **Оплата и возврат средств**
   - Payment Service
   - Реактивное уведомление других сервисов через Kafka

4. **Управление лояльностью пользователей**
   - Loyalty Service
   - Асинхронная обработка начислений и возвратов баллов

5. **Сбор аналитики**
   - Analytic Service
   - Полностью асинхронный бизнес-процесс

---

## Взаимодействие сервисов

### gRPC
Используется для:
- получения данных мастер-систем
- выполнения синхронных валидаций
- обеспечения строгих контрактов между сервисами

### Kafka
Используется для:
- асинхронной передачи бизнес-событий
- реализации eventual consistency
- интеграции аналитики
- снижения связности между сервисами

---

## Итог

Разработанная система:
- соответствует требованиям командного микросервисного проекта
- использует gRPC и Kafka для разных типов взаимодействия
- содержит мастер-системы для ключевых сущностей
- реализует несколько связанных бизнес-процессов
- отражает реальные бизнес-сценарии предметной области
